import{r as g,S as R,j as e,a as W,f as U}from"./app-BERX4-n9.js";import{M as Z,P as $}from"./PageHeader-yVcw4ftL.js";import{T as q}from"./Table-CzKAhJT7.js";import{B as i}from"./Button-B55y3AIg.js";import{M as _}from"./Modal-Bi7oDWe2.js";import{B as G,C as Q,a as V,L as X,b as Y,p as ee,c as se,d as ae}from"./index-DCpl5ra5.js";import"./transition-CvAcBJsu.js";Q.register(V,X,Y,ee,se,ae);function ue({risks:b,riskStatus:o,riskReports:C}){const[D,p]=g.useState(!1),[S,k]=g.useState(!1),[h,y]=g.useState(!1),[M,T]=g.useState(null),{data:d,setData:r,post:B,put:L,errors:t,reset:v,processing:O}=R({type:"",impact:"",status:"",recommendation:""}),a=R({report_date:"",risk_type:"",description:"",recommended_action:""}),E=[{header:"Jenis Risiko",accessor:"type"},{header:"Dampak",accessor:"impact"},{header:"Status",accessor:"status"},{header:"Rekomendasi Pelanggan",accessor:"recommendation"}],F=()=>{v(),y(!1),p(!0)},N=()=>{a.reset(),k(!0)},A=s=>{y(!0),T(s),r({type:s.type,impact:s.impact,status:s.status,recommendation:s.recommendation}),p(!0)},l=()=>{p(!1),v()},f=()=>{k(!1),a.reset()},J=s=>{s.preventDefault(),h?L(route("risks.update",M.id),{onSuccess:()=>{l()}}):B(route("risks.store"),{onSuccess:()=>{l()}})},w=s=>{s.preventDefault(),a.post(route("risk-reports.store"),{onSuccess:()=>{f()}})},K=s=>{confirm("Apakah Anda yakin ingin menghapus data ini?")&&U.delete(route("risks.destroy",s.id))},c=(()=>{const s=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],n={};return s.forEach(u=>{n[u]={Tinggi:0,Sedang:0,Rendah:0}}),C.forEach(u=>{const H=new Date(u.report_date).getMonth(),j=s[H],x=b.find(z=>z.type===u.risk_type);x&&(x.status.includes("Tinggi")?n[j].Tinggi++:x.status.includes("Sedang")?n[j].Sedang++:x.status.includes("Rendah")&&n[j].Rendah++)}),n})(),m=Object.keys(c),P={labels:m,datasets:[{label:"Risiko Tinggi",data:m.map(s=>c[s].Tinggi),backgroundColor:"rgba(255, 99, 132, 0.6)"},{label:"Risiko Sedang",data:m.map(s=>c[s].Sedang),backgroundColor:"rgba(255, 206, 86, 0.6)"},{label:"Risiko Rendah",data:m.map(s=>c[s].Rendah),backgroundColor:"rgba(75, 192, 192, 0.6)"}]},I={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Tren Mitigasi Risiko"}},scales:{y:{beginAtZero:!0}}};return e.jsxs(Z,{children:[e.jsx(W,{title:"Analisis Risiko"}),e.jsx($,{title:"Analisis Risiko",description:`Status Terkini: ${o}`}),e.jsxs("div",{className:"p-4 md:p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Indikator Warna"})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-2",children:e.jsx("input",{type:"radio",id:"green",name:"indicator",className:"h-4 w-4 accent-green-500",checked:o==="Risiko Rendah",readOnly:!0})}),e.jsx("label",{htmlFor:"green",className:"text-gray-700",children:"Hijau: Aman"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-2",children:e.jsx("input",{type:"radio",id:"yellow",name:"indicator",className:"h-4 w-4 accent-yellow-500",checked:o==="Risiko Sedang",readOnly:!0})}),e.jsx("label",{htmlFor:"yellow",className:"text-gray-700",children:"Kuning: Waspada"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"mr-2",children:e.jsx("input",{type:"radio",id:"red",name:"indicator",className:"h-4 w-4 accent-red-500",checked:o==="Risiko Tinggi",readOnly:!0})}),e.jsx("label",{htmlFor:"red",className:"text-gray-700",children:"Merah: Berbahaya"})]})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg md:text-xl font-semibold",children:"Diagram Mitigasi Risiko"})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:e.jsx(G,{data:P,options:I})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold mb-2 md:mb-0",children:"Tabel Daftar Risiko"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2",children:[e.jsx(i,{onClick:N,variant:"white",children:"Buat Laporan"}),e.jsx(i,{onClick:F,children:"Tambah Risiko"})]})]}),e.jsx(q,{columns:E,data:b,actions:s=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"white",size:"sm",onClick:()=>A(s),children:"Edit"}),e.jsx(i,{variant:"danger",size:"sm",onClick:()=>K(s),children:"Hapus"})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold mb-2 md:mb-0",children:"Formulir Pelaporan Risiko"}),e.jsx(i,{onClick:N,className:"mb-2 md:mb-0",children:"Buat Laporan Baru"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 md:p-6",children:e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Laporan"}),e.jsx("input",{type:"date",value:a.data.report_date,onChange:s=>a.setData("report_date",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),a.errors.report_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.report_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jenis Risiko"}),e.jsxs("select",{value:a.data.risk_type,onChange:s=>a.setData("risk_type",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Pilih jenis risiko"}),e.jsx("option",{value:"Operasional",children:"Operasional"}),e.jsx("option",{value:"Finansial",children:"Finansial"}),e.jsx("option",{value:"Keamanan",children:"Keamanan"}),e.jsx("option",{value:"Lingkungan",children:"Lingkungan"})]}),a.errors.risk_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.risk_type})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("textarea",{value:a.data.description,onChange:s=>a.setData("description",s.target.value),rows:4,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Deskripsikan laporan risiko"}),a.errors.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.description})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tindakan yang Direkomendasikan"}),e.jsx("textarea",{value:a.data.recommended_action,onChange:s=>a.setData("recommended_action",s.target.value),rows:4,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Jelaskan tindakan yang harus diambil"}),a.errors.recommended_action&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.recommended_action})]}),e.jsx("div",{className:"mt-6 text-right",children:e.jsx(i,{type:"submit",disabled:a.processing,children:"Kirim Laporan"})})]})})]})]}),e.jsx(_,{show:D,onClose:l,title:h?"Edit Risiko":"Tambah Risiko",children:e.jsxs("form",{onSubmit:J,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jenis Risiko"}),e.jsx("input",{type:"text",value:d.type,onChange:s=>r("type",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),t.type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.type})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dampak"}),e.jsx("input",{type:"text",value:d.impact,onChange:s=>r("impact",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),t.impact&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.impact})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:d.status,onChange:s=>r("status",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Pilih status"}),e.jsx("option",{value:"Risiko Rendah",children:"Risiko Rendah"}),e.jsx("option",{value:"Risiko Sedang",children:"Risiko Sedang"}),e.jsx("option",{value:"Risiko Tinggi",children:"Risiko Tinggi"})]}),t.status&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.status})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rekomendasi"}),e.jsx("textarea",{value:d.recommendation,onChange:s=>r("recommendation",s.target.value),rows:4,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),t.recommendation&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.recommendation})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(i,{variant:"white",onClick:l,children:"Batal"}),e.jsx(i,{type:"submit",disabled:O,children:h?"Update":"Simpan"})]})]})}),e.jsx(_,{show:S,onClose:f,title:"Laporan Risiko Baru",children:e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Laporan"}),e.jsx("input",{type:"date",value:a.data.report_date,onChange:s=>a.setData("report_date",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"}),a.errors.report_date&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.report_date})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jenis Risiko"}),e.jsxs("select",{value:a.data.risk_type,onChange:s=>a.setData("risk_type",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:[e.jsx("option",{value:"",children:"Pilih jenis risiko"}),e.jsx("option",{value:"Operasional",children:"Operasional"}),e.jsx("option",{value:"Finansial",children:"Finansial"}),e.jsx("option",{value:"Keamanan",children:"Keamanan"}),e.jsx("option",{value:"Lingkungan",children:"Lingkungan"})]}),a.errors.risk_type&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.risk_type})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("textarea",{value:a.data.description,onChange:s=>a.setData("description",s.target.value),rows:4,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Deskripsikan laporan risiko"}),a.errors.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.description})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tindakan yang Direkomendasikan"}),e.jsx("textarea",{value:a.data.recommended_action,onChange:s=>a.setData("recommended_action",s.target.value),rows:4,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",placeholder:"Jelaskan tindakan yang harus diambil"}),a.errors.recommended_action&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.errors.recommended_action})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(i,{variant:"white",onClick:f,children:"Batal"}),e.jsx(i,{type:"submit",disabled:a.processing,children:"Kirim Laporan"})]})]})})]})}export{ue as default};
