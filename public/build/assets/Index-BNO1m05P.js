import{r as i,S as E,j as e,a as de,f as O}from"./app-DjzuJKlb.js";import{t as n,M as ce}from"./MainLayout-J42EoWy0.js";import{P as me}from"./PageHeader-6ziFw4xD.js";import{T as F}from"./Table-CVjz0cPf.js";import{B as l}from"./Button-DMMHKGT7.js";import{M as z}from"./Modal-B2ihAEHI.js";import{P as ue,g as he,C as ge,a as pe,b as xe,B as be,A as ke,p as fe,e as we,f as ve}from"./index-DY2-FcHb.js";import{k as je}from"./index-Bq36l_Lg.js";import"./transition-DD-WAN0o.js";ge.register(pe,xe,be,ke,fe,we,ve);function Ae({risks:d,riskStatus:ye,riskReports:L}){const[J,w]=i.useState(!1),[P,M]=i.useState(!1),[v,D]=i.useState(!1),[W,$]=i.useState(null),[j,H]=i.useState(""),[y,Ne]=i.useState("Semua"),[N,K]=i.useState(""),[p,Y]=i.useState(new Date().getFullYear().toString()),{data:r,setData:c,post:V,put:U,errors:x,reset:T,processing:_}=E({type:"",likelihood:"Sedang",impact:"Sedang",risk_level:"Menengah",recommendation:""}),a=E({report_date:new Date().toISOString().slice(0,10),risk_type:"",description:"",recommended_action:""}),Z={Rendah:"bg-green-100 text-green-800",Menengah:"bg-yellow-100 text-yellow-800",Tinggi:"bg-orange-100 text-orange-800",Ekstrim:"bg-red-100 text-red-800"},q=[{header:"Nama Risiko/Jenis",accessor:"type"},{header:"Potensi Dampak",accessor:"impact"},{header:"Tingkat Risiko",accessor:"status",cell:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Z[s]||"bg-gray-100 text-gray-800"}`,children:s})},{header:"Rekomendasi Mitigasi",accessor:"recommendation"}],G=[{header:"Tanggal Laporan",accessor:"report_date",cell:s=>new Date(s).toLocaleDateString("id-ID",{day:"2-digit",month:"short",year:"numeric"})},{header:"Jenis Risiko Terkait",accessor:"risk_type"},{header:"Deskripsi Insiden",accessor:"description",cell:s=>e.jsx("div",{className:"whitespace-normal break-words max-w-xs",children:s})},{header:"Rekomendasi Tindakan",accessor:"recommended_action",cell:s=>e.jsx("div",{className:"whitespace-normal break-words max-w-xs",children:s})}],R=(s,t)=>{const o={Rendah:1,Sedang:2,Tinggi:3,"Sangat Tinggi":4},h=o[s]||1,m=o[t]||1,g=h*m;return g<=2?"Rendah":g<=4?"Menengah":g<=8?"Tinggi":"Ekstrim"};i.useEffect(()=>{r.likelihood&&r.impact&&c("risk_level",R(r.likelihood,r.impact))},[r.likelihood,r.impact]);const Q=()=>{T(),c({type:"",likelihood:"Sedang",impact:"Sedang",risk_level:R("Sedang","Sedang"),recommendation:""}),D(!1),w(!0)},X=()=>{a.reset(),a.setData({report_date:new Date().toISOString().slice(0,10),risk_type:"",description:"",recommended_action:""}),M(!0)},ee=s=>{D(!0),$(s),c({type:s.type||"",likelihood:s.likelihood||"Sedang",impact:s.impact||"Sedang",risk_level:s.status||R(s.likelihood||"Sedang",s.impact||"Sedang"),recommendation:s.recommendation||""}),w(!0)},b=()=>{w(!1),T()},C=()=>{M(!1),a.reset()},se=s=>{s.preventDefault();const t={type:r.type,impact:r.impact,status:r.risk_level,recommendation:r.recommendation};v?U(route("risks.update",W.id),{data:t,onSuccess:()=>b()}):V(route("risks.store"),{data:t,onSuccess:()=>b()})},ae=s=>{s.preventDefault(),a.post(route("risk-reports.store"),{onSuccess:()=>C()})},te=s=>{confirm(`Apakah Anda yakin ingin menghapus risiko: ${s.risk_name}?`)&&O.delete(route("risks.destroy",s.id))},re=s=>{confirm(`Apakah Anda yakin ingin menghapus laporan insiden tanggal ${new Date(s.report_date).toLocaleDateString("id-ID")}?`)&&O.delete(route("risk-reports.destroy",s.id))},k=i.useMemo(()=>d.filter(s=>{var m,g,A,B;const t=j.toLowerCase(),o=(((m=s.type)==null?void 0:m.toLowerCase())??"").includes(t)||(((g=s.impact)==null?void 0:g.toLowerCase())??"").includes(t)||(((A=s.recommendation)==null?void 0:A.toLowerCase())??"").includes(t),h=y==="Semua"||(((B=s.status)==null?void 0:B.toLowerCase())??"")===y.toLowerCase();return o&&h}),[d,j,y]),f=i.useMemo(()=>L.filter(s=>new Date(s.report_date).getFullYear().toString()===p).filter(s=>{var o,h,m;const t=N.toLowerCase();return(((o=s.description)==null?void 0:o.toLowerCase())??"").includes(t)||(((h=s.risk_type)==null?void 0:h.toLowerCase())??"").includes(t)||(((m=s.recommended_action)==null?void 0:m.toLowerCase())??"").includes(t)}),[L,N,p]),I=i.useMemo(()=>{const s={Rendah:0,Menengah:0,Tinggi:0,Ekstrim:0};return k.forEach(t=>{let o=t.status;o==="Sedang"&&(o="Menengah"),s.hasOwnProperty(o)&&s[o]++}),s},[k]),oe={labels:Object.keys(I),datasets:[{data:Object.values(I),backgroundColor:[n.colors.accent.success,n.colors.accent.warning,n.colors.primary[500],n.colors.accent.danger],borderColor:n.colors.neutral.white,borderWidth:2}]},ie=i.useMemo(()=>{const s=Array(12).fill(0);return f.forEach(t=>{const o=new Date(t.report_date).getMonth();s[o]=(s[o]||0)+1}),s},[f]),ne={labels:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],datasets:[{label:"Jumlah Laporan",data:ie,backgroundColor:n.colors.primary[600]}]},S={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{color:n.colors.neutral[700]}},title:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{color:n.colors.neutral[600]},grid:{color:n.colors.neutral[200]}},x:{ticks:{color:n.colors.neutral[600]},grid:{display:!1}}}},u=i.useMemo(()=>d.some(s=>s.status==="Ekstrim")?{level:"Ekstrim",color:"red-600",icon:"🔥",textColor:"text-white",toColor:"red-800"}:d.some(s=>s.status==="Tinggi")?{level:"Tinggi",color:"orange-500",icon:"🔶",textColor:"text-gray-800",toColor:"orange-700"}:d.some(s=>s.status==="Menengah")?{level:"Menengah",color:"yellow-500",icon:"⚠️",textColor:"text-gray-800",toColor:"yellow-700"}:d.some(s=>s.status==="Rendah")?{level:"Rendah",color:"green-500",icon:"✅",textColor:"text-gray-800",toColor:"green-700"}:{level:"Rendah",color:"green-500",icon:"✅",textColor:"text-gray-800",toColor:"green-700"},[d]),le=Array.from({length:5},(s,t)=>new Date().getFullYear()-t);return e.jsxs(ce,{children:[e.jsx(de,{title:"Analisis Risiko"}),e.jsx(me,{title:"Analisis & Manajemen Risiko",description:"Identifikasi, evaluasi, dan mitigasi potensi risiko di operasional pelabuhan.",pattern:"shipWheel",actions:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(l,{onClick:Q,className:"bg-white text-blue-800 hover:bg-blue-100 transition-colors shadow-md",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Identifikasi Risiko Baru"]}),e.jsxs(l,{onClick:X,variant:"secondary",className:"bg-teal-600 hover:bg-teal-700 text-white shadow-md",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Lapor Insiden"]})]})}),e.jsxs("div",{className:"p-8 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:`lg:col-span-1 bg-gradient-to-br from-${u.color} to-${u.toColor} p-6 rounded-xl shadow-lg ${u.textColor} flex flex-col justify-center items-center`,children:[e.jsx("div",{className:"text-6xl mb-3",children:u.icon}),e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Status Risiko Keseluruhan"}),e.jsx("p",{className:"text-3xl font-black tracking-tight",children:u.level}),e.jsx("p",{className:`text-sm mt-1 ${u.textColor==="text-white"?"opacity-80":"opacity-75"}`,children:"Berdasarkan data risiko aktif saat ini."})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white p-6 rounded-xl shadow-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Distribusi Tingkat Risiko Aktif"}),e.jsx("div",{className:"h-64 md:h-72",children:k.length>0?e.jsx(ue,{data:oe,options:{...S,plugins:{...S.plugins,legend:{position:"right"}}}}):e.jsx("p",{className:"text-gray-500 text-center pt-10",children:"Tidak ada data risiko aktif untuk ditampilkan."})})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-md overflow-hidden mb-8",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-1",children:"Daftar Identifikasi Risiko"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Kelola semua risiko yang telah teridentifikasi."}),e.jsx("div",{className:"flex flex-col md:flex-row justify-between md:items-center mb-4 space-y-3 md:space-y-0",children:e.jsxs("div",{className:"relative w-full md:w-2/5",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Cari nama risiko, kategori, PIC...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm",value:j,onChange:s=>H(s.target.value)})]})}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:e.jsx(F,{columns:q,data:k,actions:s=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs(l,{variant:"white",size:"sm",onClick:()=>ee(s),className:"border border-gray-300 hover:bg-gray-100",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})," Edit"]}),e.jsxs(l,{variant:"danger",size:"sm",onClick:()=>te(s),className:"bg-red-600 text-white hover:bg-red-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})," Hapus"]})]})})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-1",children:"Laporan Insiden Risiko"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Daftar semua insiden yang dilaporkan terkait risiko."}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center mb-4 space-y-3 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-year-filter",className:"sr-only",children:"Tahun Laporan"}),e.jsx("select",{id:"report-year-filter",value:p,onChange:s=>Y(s.target.value),className:"py-2 pl-3 pr-8 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 shadow-sm text-sm",children:le.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"relative w-full md:w-2/5",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Cari laporan...",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm",value:N,onChange:s=>K(s.target.value)})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200",children:e.jsx(F,{columns:G,data:f,actions:s=>e.jsx("div",{className:"flex justify-end",children:e.jsx(l,{variant:"danger",size:"xs",onClick:()=>re(s),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded-md text-xs",children:e.jsx(je,{})})})})})]})}),e.jsxs("div",{className:"lg:col-span-1 bg-white p-6 rounded-xl shadow-md",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:["Tren Laporan Insiden (",p,")"]}),e.jsx("div",{className:"h-80 md:h-96",children:f.length>0?e.jsx(he,{data:ne,options:S}):e.jsxs("p",{className:"text-gray-500 text-center pt-10",children:["Tidak ada data laporan insiden untuk ditampilkan pada tahun ",p,"."]})})]})]})]}),e.jsx(z,{show:J,onClose:b,title:v?"Edit Identifikasi Risiko":"Identifikasi Risiko Baru",maxWidth:"2xl",children:e.jsxs("form",{onSubmit:se,className:"space-y-4 p-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama/Jenis Risiko"}),e.jsx("input",{type:"text",value:r.type,onChange:s=>c("type",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",placeholder:"Contoh: Kerusakan Alat Berat"}),x.type&&e.jsx("p",{className:"error-message",children:x.type})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kemungkinan Terjadi (Likelihood)"}),e.jsxs("select",{value:r.likelihood,onChange:s=>c("likelihood",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",children:[e.jsx("option",{value:"Rendah",children:"Rendah (Rare)"}),e.jsx("option",{value:"Sedang",children:"Sedang (Possible)"}),e.jsx("option",{value:"Tinggi",children:"Tinggi (Likely)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dampak Jika Terjadi (Impact)"}),e.jsxs("select",{value:r.impact,onChange:s=>c("impact",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",children:[e.jsx("option",{value:"Rendah",children:"Rendah (Insignificant)"}),e.jsx("option",{value:"Sedang",children:"Sedang (Minor)"}),e.jsx("option",{value:"Tinggi",children:"Tinggi (Moderate)"}),e.jsx("option",{value:"Sangat Tinggi",children:"Sangat Tinggi (Major/Catastrophic)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tingkat Risiko (Otomatis)"}),e.jsx("input",{type:"text",value:r.risk_level,readOnly:!0,className:"w-full rounded-md border-gray-300 bg-gray-100 shadow-sm p-2.5 cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rekomendasi Mitigasi"}),e.jsx("textarea",{value:r.recommendation,onChange:s=>c("recommendation",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",rows:"3",placeholder:"Rencana tindakan untuk mengurangi kemungkinan atau dampak risiko..."}),x.recommendation&&e.jsx("p",{className:"error-message",children:x.recommendation})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(l,{variant:"white",onClick:b,className:"border border-gray-300",children:"Batal"}),e.jsx(l,{type:"submit",disabled:_,className:"bg-blue-700 hover:bg-blue-800 text-white",children:_?"Menyimpan...":v?"Update Risiko":"Simpan Risiko"})]})]})}),e.jsxs(z,{show:P,onClose:C,title:"Lapor Insiden Baru",maxWidth:"xl",children:[e.jsxs("form",{onSubmit:ae,className:"space-y-4 p-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Pelaporan"}),e.jsx("input",{type:"date",value:a.data.report_date,onChange:s=>a.setData("report_date",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5"}),a.errors.report_date&&e.jsx("p",{className:"error-message",children:a.errors.report_date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jenis Risiko Terkait"}),e.jsx("input",{type:"text",value:a.data.risk_type,onChange:s=>a.setData("risk_type",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",placeholder:"Contoh: Risiko Operasional Pelabuhan"}),a.errors.risk_type&&e.jsx("p",{className:"error-message",children:a.errors.risk_type})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi Kejadian"}),e.jsx("textarea",{value:a.data.description,onChange:s=>a.setData("description",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",rows:"4",placeholder:"Jelaskan insiden yang terjadi, kapan, dimana, dan siapa yang terlibat..."}),a.errors.description&&e.jsx("p",{className:"error-message",children:a.errors.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rekomendasi Tindakan"}),e.jsx("textarea",{value:a.data.recommended_action,onChange:s=>a.setData("recommended_action",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-2.5",rows:"3",placeholder:"Rekomendasi tindakan untuk menangani insiden..."}),a.errors.recommended_action&&e.jsx("p",{className:"error-message",children:a.errors.recommended_action})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(l,{variant:"white",onClick:C,className:"border border-gray-300",children:"Batal"}),e.jsx(l,{type:"submit",disabled:a.processing,className:"bg-teal-600 hover:bg-teal-700 text-white",children:a.processing?"Mengirim...":"Kirim Laporan"})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
          .input-class {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            border-width: 1px;
            border-color: #D1D5DB; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
          }
          .input-class:focus {
            border-color: #60A5FA; /* blue-300 */
            outline: 2px solid transparent;
            outline-offset: 2px;
            --tw-ring-color: #93C5FD; /* blue-200 */
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
          }
          .error-message {
            margin-top: 0.25rem;
            font-size: 0.875rem;
            color: #EF4444; /* red-600 */
          }
        `})]})]})}export{Ae as default};
